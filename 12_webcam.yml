# FIXME!!! full compilation process
#- apt:
#    name:
#      - v4l-utils
#      - cmake
#      - libjpeg8-dev
#
#- shell: |
#    git clone https://github.com/jacksonliam/mjpg-streamer.git /root/mjpg-streamer
#    cd /root/mjpg-streamer/mjpg-streamer-experimental
#    make distclean
#    make

- shell: echo "DEVICE=$(/usr/bin/v4l2-ctl --media-bus-info  usb-12110000.usb-1 --list-devices | grep video | head -n 1)" > /root/mjpg-streamer/mjpg-streamer-experimental/environment

- template:
    src: etc/systemd/system/webcam.service
    dest: /etc/systemd/system/webcam.service
  register: webcam_service

- systemd:
    name: webcam.service
    state: restarted
    daemon_reload: true
  when: (webcam_service is changed)

- systemd:
    name: webcam.service
    state: started
    enabled: true
